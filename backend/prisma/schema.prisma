// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(uuid())
  name         String
  email        String         @unique
  passwordHash String
  createdAt    DateTime       @default(now())
  
  ownedGroups  Group[]        @relation("GroupOwner")
  memberships  GroupMember[]
  expensesPaid Expense[]      @relation("ExpensePayer")
  shares       ExpenseShare[]
  
  paymentsSent     Payment[]  @relation("PaymentSender")
  paymentsReceived Payment[]  @relation("PaymentReceiver")
}

model Group {
  id          String        @id @default(uuid())
  name        String
  description String?
  ownerId     String
  owner       User          @relation("GroupOwner", fields: [ownerId], references: [id])
  createdAt   DateTime      @default(now())
  
  members     GroupMember[]
  expenses    Expense[]
  payments    Payment[]
}

model GroupMember {
  id        String   @id @default(uuid())
  groupId   String
  group     Group    @relation(fields: [groupId], references: [id])
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  joinedAt  DateTime @default(now())

  @@unique([groupId, userId])
}

model Expense {
  id           String         @id @default(uuid())
  groupId      String
  group        Group          @relation(fields: [groupId], references: [id])
  title        String
  amount       Decimal
  paidByUserId String
  paidBy       User           @relation("ExpensePayer", fields: [paidByUserId], references: [id])
  date         DateTime       @default(now())
  note         String?
  
  shares       ExpenseShare[]
}

model ExpenseShare {
  id          String  @id @default(uuid())
  expenseId   String
  expense     Expense @relation(fields: [expenseId], references: [id])
  userId      String
  user        User    @relation(fields: [userId], references: [id])
  shareAmount Decimal
}

model Payment {
  id           String   @id @default(uuid())
  groupId      String
  group        Group    @relation(fields: [groupId], references: [id])
  fromUserId   String
  fromUser     User     @relation("PaymentSender", fields: [fromUserId], references: [id])
  toUserId     String
  toUser       User     @relation("PaymentReceiver", fields: [toUserId], references: [id])
  amount       Decimal
  date         DateTime @default(now())
  note         String?
}
